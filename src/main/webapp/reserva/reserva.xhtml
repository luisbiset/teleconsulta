<ui:composition template="/template/layout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="jakarta.faces.facelets"
	xmlns:h="jakarta.faces.html" xmlns:f="jakarta.faces.core"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="conteudo">

		<h:form id="formReserva">

			<p:growl id="msgs" showDetail="false" />

			<h2 style="margin-bottom: 20px;">Gerenciamento de Reservas</h2>

			<p:commandButton value="Nova Reserva" icon="pi pi-plus"
				action="#{reservaController.novo}" update=":formReserva:dlg msgs"
				oncomplete="PF('dlgReserva').show()" />


			<br />
			<br />

			<!-- ================= TABELA ================= -->
			<p:dataTable value="#{reservaController.reservas}" var="r"
				paginator="true" rows="10" paginatorPosition="bottom">

				<p:column headerText="Solicitante">
					<h:outputText value="#{r.usuarioSolicitante.nome}" />
				</p:column>

				<p:column headerText="Unidade">
					<h:outputText value="#{r.sala.unidade.nome}" />
				</p:column>


				<p:column headerText="Sala">
					<h:outputText value="#{r.sala.nome}" />
				</p:column>


				<p:column headerText="Início">
					<h:outputText value="#{r.dataInicio}"
						converter="localDateTimeConverter" />
				</p:column>

				<p:column headerText="Término">
					<h:outputText value="#{r.dataFim}"
						converter="localDateTimeConverter" />
				</p:column>


				<p:column headerText="Ações" style="width:140px;text-align:center">

					<p:commandButton icon="pi pi-pencil" process="@this"
						update=":formReserva:dlg msgs"
						action="#{reservaController.editar(r)}"
						oncomplete="PF('dlgReserva').show()" />

					<p:commandButton icon="pi pi-trash" process="@this"
						update="@form msgs" action="#{reservaController.excluir(r.id)}"
						onclick="return confirm('Deseja cancelar esta reserva?');" />

				</p:column>

			</p:dataTable>
			<p:dialog id="dlg" widgetVar="dlgReserva"
				header="Cadastro de Reserva" modal="true" width="650"
				closable="true">

				<div style="display: flex; flex-direction: column; gap: 16px;">

					<!-- CPF -->
					<div style="display: flex; align-items: center;">
						<div style="width: 180px; font-weight: 600;">CPF do Usuário:</div>
						<p:inputMask mask="999.999.999-99"
             style="flex:1;"
             value="#{reservaController.cpfSolicitante}"
             disabled="#{reservaController.modoEdicao}">
						</p:inputMask>
					</div>

					<!-- SOLICITANTE -->
					<div style="display: flex; align-items: center;">
						<div style="width: 180px; font-weight: 600;">Solicitante:</div>
						<p:inputText id="nomeSolicitante"
							style="flex:1;
                            height:42px;
                            padding:8px 12px;
                            box-sizing:border-box;
                            background-color:#f5f5f5;
                            border:1px solid #ccc;
                            color:#555;
                            cursor:not-allowed;"
							value="#{reservaController.reserva.usuarioSolicitante.nome}"
							readonly="true" />
					</div>

					<!-- UNIDADE -->
					<div style="display: flex; align-items: center;">
						<div style="width: 180px; font-weight: 600;">Unidade:</div>
						<p:selectOneMenu value="#{reservaController.idUnidadeSelecionada}"
							style="flex:1;" required="true"
							disabled="#{reservaController.modoEdicao}">


							<f:selectItem itemLabel="Selecione" itemValue="#{null}" />
							<f:selectItems value="#{reservaController.unidades}" var="u"
								itemLabel="#{u.nome}" itemValue="#{u.id}" />

							<p:ajax listener="#{reservaController.carregarSalasDaUnidade}"
								update="comboSala msgs" />
						</p:selectOneMenu>
					</div>

					<!-- SALA (DEPENDE DA UNIDADE) -->
					<div style="display: flex; align-items: center;">
						<div style="width: 180px; font-weight: 600;">Sala:</div>
						<p:selectOneMenu id="comboSala"
							value="#{reservaController.idSalaSelecionada}" style="flex:1;"
							required="true" disabled="#{reservaController.modoEdicao}">


							<f:selectItem itemLabel="Selecione" itemValue="#{null}" />
							<f:selectItems value="#{reservaController.salasDaUnidade}"
								var="s" itemLabel="#{s.nome}" itemValue="#{s.id}" />
						</p:selectOneMenu>
					</div>

					<!-- INÍCIO -->
					<div style="display: flex; align-items: center;">
						<div style="width: 180px; font-weight: 600;">Início:</div>
						<p:datePicker value="#{reservaController.reserva.dataInicio}"
							style="flex:1;" pattern="dd/MM/yyyy HH:mm" showTime="true"
							required="true" converter="localDateTimeConverter" />
					</div>

					<!-- TÉRMINO -->
					<div style="display: flex; align-items: center;">
						<div style="width: 180px; font-weight: 600;">Término:</div>
						<p:datePicker value="#{reservaController.reserva.dataFim}"
							style="flex:1;" pattern="dd/MM/yyyy HH:mm" showTime="true"
							required="true" converter="localDateTimeConverter" />
					</div>

				</div>

				<!-- BOTÕES -->
				<div
					style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 22px;">

					<p:commandButton value="Salvar" icon="pi pi-save"
						action="#{reservaController.salvar}" update=":formReserva msgs"
						oncomplete="PF('dlgReserva').hide();" />

					<p:commandButton value="Cancelar" icon="pi pi-times"
						onclick="PF('dlgReserva').hide(); return false;"
						styleClass="ui-button-secondary" />
				</div>


			</p:dialog>




		</h:form>

	</ui:define>

</ui:composition>
